<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TinyMCE Custom Button</title>
    <style>
      .tox-tinymce {
        height: 500px !important;
      }
    </style>
    <!-- Include TinyMCE library -->
    <script src="https://cdn.tiny.cloud/1/4hhr5zb6n9r2mk2zgzmfpy0o0ma0v3iesval5k612f1r0dj7/tinymce/5.1.4/tinymce.min.js"></script>
  </head>
  <body>
    <!-- Create a textarea for TinyMCE editor -->
    <textarea id="myEditor"></textarea>

    <script>
      const openDialog = (editor) => {
        let defaultValues = {};
        const selectedCells = tinymce.activeEditor.dom.getParents(
          tinymce.activeEditor.selection.getNode(),
          "td"
        );

        // Apply the selected border style to each selected cell
        selectedCells.forEach((cell) => {
          defaultValues = cell.style;
        });
        console.log({ defaultValues });

        // Merge default values with existing settings
        editor.windowManager.open({
          title: "Cell Properties",
          body: {
            type: "tabpanel",
            tabs: [
              // Genral Panel Start
              {
                type: "panel",
                title: "General",
                items: [
                  {
                    type: "input",
                    name: "width",
                    label: "Width",
                    placeholder: "10%"
                  },
                  {
                    type: "input",
                    name: "height",
                    label: "Height",
                    placeholder: "10px"
                  },
                  {
                    type: "selectbox",
                    name: "cellType",
                    label: "Cell Type",
                    items: [
                      { value: "cell", text: "Cell" },
                      { value: "cellHeader", text: "Header Cell" }
                    ]
                  },
                  {
                    type: "selectbox",
                    name: "scope",
                    label: "Scope",
                    items: [
                      { value: "", text: "None" },
                      { value: "row", text: "Row" },
                      { value: "col", text: "Column" },
                      { value: "rowgroup", text: "Row Group" },
                      { value: "colgroup", text: "Column Group" }
                    ]
                  },
                  {
                    type: "selectbox",
                    name: "textAlign",
                    label: "H Align",
                    items: [
                      { value: "", text: "None" },
                      { value: "left", text: "Left" },
                      { value: "center", text: "Center" },
                      { value: "right", text: "Right" }
                    ]
                  },
                  {
                    type: "selectbox",
                    name: "verticalAlign",
                    label: "V Align",
                    items: [
                      { value: "", text: "None" },
                      { value: "top", text: "Top" },
                      { value: "middle", text: "Middle" },
                      { value: "bottom", text: "Bottom" }
                    ]
                  }
                ]
              },
              // Genral Panel End

              // Advance Panel Start
              {
                type: "panel",
                title: "Advance",
                items: [
                  {
                    type: "input",
                    name: "borderWidth",
                    label: "Border width"
                  },
                  {
                    type: "selectbox",
                    name: "borderStyle",
                    label: "Border Style",
                    items: [
                      { value: "", text: "None" },
                      { value: "solid", text: "Solid" },
                      { value: "dotted", text: "Dotted" },
                      { value: "dashed", text: "Dashed" },
                      { value: "double", text: "Double" },
                      { value: "groove", text: "Groove" },
                      { value: "inset", text: "Inset" },
                      { value: "ridge", text: "Ridge" },
                      { value: "outset", text: "Outset" },
                      { value: "initial", text: "Initial" },
                      { value: "inherit", text: "Inherit" }
                    ]
                  },
                  {
                    type: "colorinput",
                    name: "borderColor",
                    label: "Border color",
                    default: "#000"
                  },
                  {
                    type: "colorinput",
                    name: "backgroundColor",
                    label: "Background color",
                    default: "#000"
                  }
                ]
              },
              // Advance Panel End
              
              // Borders Panel Start
              {
                type: "panel",
                title: "Border",
                items: [
                  {
                    type: "label",
                    name: "top",
                    label: "<span style='font-weight:800;'>TOP</span>",
                    items: [
                      {
                        type: "bar",
                        items: [
                          {
                            type: "input",
                            name: "borderTopWidth",
                            label: "Width"
                          },
                          {
                            type: "colorinput",
                            name: "borderTopColor",
                            label: "Color",
                            default: "#000"
                          }
                        ]
                      },
                      {
                        type: "selectbox",
                        name: "borderTopStyle",
                        label: "Style",
                        items: [
                          { value: "", text: "None" },
                          { value: "solid", text: "Solid" },
                          { value: "dotted", text: "Dotted" },
                          { value: "dashed", text: "Dashed" },
                          { value: "double", text: "Double" },
                          { value: "groove", text: "Groove" },
                          { value: "inset", text: "Inset" },
                          { value: "ridge", text: "Ridge" },
                          { value: "outset", text: "Outset" },
                          { value: "initial", text: "Initial" },
                          { value: "inherit", text: "Inherit" }
                        ]
                      }
                    ]
                  },
                  {
                    type: "label",
                    name: "right",
                    label: "<span style='font-weight:800;'>RIGHT</span>",
                    items: [
                      {
                        type: "bar",
                        items: [
                          {
                            type: "input",
                            name: "borderRightWidth",
                            label: "Width"
                          },
                          {
                            type: "colorinput",
                            name: "borderRightColor",
                            label: "Color",
                            default: "#000"
                          }
                        ]
                      },
                      {
                        type: "selectbox",
                        name: "borderRightStyle",
                        label: "Style",
                        items: [
                          { value: "", text: "None" },
                          { value: "solid", text: "Solid" },
                          { value: "dotted", text: "Dotted" },
                          { value: "dashed", text: "Dashed" },
                          { value: "double", text: "Double" },
                          { value: "groove", text: "Groove" },
                          { value: "inset", text: "Inset" },
                          { value: "ridge", text: "Ridge" },
                          { value: "outset", text: "Outset" },
                          { value: "initial", text: "Initial" },
                          { value: "inherit", text: "Inherit" }
                        ]
                      }
                    ]
                  },
                  {
                    type: "label",
                    name: "bottom",
                    label: "<span style='font-weight:800;'>BOTTOM</span>",
                    items: [
                      {
                        type: "bar",
                        items: [
                          {
                            type: "input",
                            name: "borderBottomWidth",
                            label: "Width"
                          },
                          {
                            type: "colorinput",
                            name: "borderBottomColor",
                            label: "Color",
                            default: "#000"
                          }
                        ]
                      },
                      {
                        type: "selectbox",
                        name: "borderBottomStyle",
                        label: "Style",
                        items: [
                          { value: "", text: "None" },
                          { value: "solid", text: "Solid" },
                          { value: "dotted", text: "Dotted" },
                          { value: "dashed", text: "Dashed" },
                          { value: "double", text: "Double" },
                          { value: "groove", text: "Groove" },
                          { value: "inset", text: "Inset" },
                          { value: "ridge", text: "Ridge" },
                          { value: "outset", text: "Outset" },
                          { value: "initial", text: "Initial" },
                          { value: "inherit", text: "Inherit" }
                        ]
                      }
                    ]
                  },
                  {
                    type: "label",
                    name: "left",
                    label: "<span style='font-weight:800;'>LEFT</span>",
                    items: [
                      {
                        type: "bar",
                        items: [
                          {
                            type: "input",
                            name: "borderLeftWidth",
                            label: "Width"
                          },
                          {
                            type: "colorinput",
                            name: "borderLeftColor",
                            label: "Color",
                            default: "#000"
                          }
                        ]
                      },
                      {
                        type: "selectbox",
                        name: "borderLeftStyle",
                        label: "Style",
                        items: [
                          { value: "", text: "None" },
                          { value: "solid", text: "Solid" },
                          { value: "dotted", text: "Dotted" },
                          { value: "dashed", text: "Dashed" },
                          { value: "double", text: "Double" },
                          { value: "groove", text: "Groove" },
                          { value: "inset", text: "Inset" },
                          { value: "ridge", text: "Ridge" },
                          { value: "outset", text: "Outset" },
                          { value: "initial", text: "Initial" },
                          { value: "inherit", text: "Inherit" }
                        ]
                      }
                    ]
                  }
                ]
              },
              // Border Panel End

              // Padding Panel Start
              {
                type: "panel",
                title: "Padding",
                items: [
                  {
                    type: "bar",
                    items: [
                      {
                        type: "label",
                        name: "top",
                        label:
                          "<span style='font-weight:800; margin-right: 22px'>Top</span>",
                        items: []
                      },
                      {
                        type: "input",
                        name: "paddingTop"
                      }
                    ]
                  },
                  {
                    type: "bar",
                    items: [
                      {
                        type: "label",
                        name: "Right",
                        label:
                          "<span style='font-weight:800; margin-right: 15px'>Right</span>",
                        items: []
                      },
                      {
                        type: "input",
                        name: "paddingRight"
                      }
                    ]
                  },
                  {
                    type: "bar",
                    items: [
                      {
                        type: "label",
                        name: "Bottom",
                        label: "<span style='font-weight:800;'>Bottom</span>",
                        items: []
                      },
                      {
                        type: "input",
                        name: "paddingBottom"
                      }
                    ]
                  },
                  {
                    type: "bar",
                    items: [
                      {
                        type: "label",
                        name: "Left",
                        label:
                          "<span style='font-weight:800; margin-right: 24px'>Left</span>",
                        items: []
                      },
                      {
                        type: "input",
                        name: "paddingLeft"
                      }
                    ]
                  }
                ]
              }
              // Padding Panel End
            ]
          },
          buttons: [
            {
              type: "cancel",
              text: "Close"
            },
            {
              type: "submit",
              text: "Save",
              buttonType: "primary"
            }
          ],

          initialData: defaultValues,

          // OnSumbit button
          onSubmit: (api) => {
            const data = api.getData();
            const selectedCells = tinymce.activeEditor.dom.getParents(
              tinymce.activeEditor.selection.getNode(),
              "td"
            );

            // Apply the selected border style to each selected cell
            selectedCells.forEach((cell) => {
              for (let styleName in data) {
                if (styleName === "width") {
                  // width
                  cell.style.width = data[styleName];
                } else if (styleName === "height") {
                  // height
                  cell.style.height = data[styleName];
                } else if (styleName === "cellType") {
                  // cell type
                  if (data.cellType === "cell") {
                    cell.style.fontWeight = "normal";
                    cell.style.cellType = data.cellType;
                  } else if (data.cellType === "cellHeader") {
                    cell.style.fontWeight = "bold";
                    cell.style.cellType = data.cellType;
                  }
                } else if (styleName === "scope") {
                  // cellScope
                  cell.setAttribute("scope", data.scope);
                  cell.style.scope = data.scope;
                } else if (styleName === "textAlign") {
                  // H Align
                  cell.style.textAlign = data.textAlign;
                } else if (styleName === "verticalAlign") {
                  // V align
                  cell.style.verticalAlign = data.verticalAlign;
                } else if (
                  // padding and margin Styles and color
                  cell?.style[styleName] !== undefined &&
                  data[styleName]
                ) {
                  cell.style[styleName] = data[styleName];
                }
              }
            });

            // Close the dialog
            api.close();
            editor.windowManager.close();
          },

          onClose: () => {
            editor.windowManager.close();
          }
        });
      };

      // Initialize TinyMCE
      tinymce.init({
        selector: "#myEditor",
        plugins:
          "advlist autolink lists link image charmap print preview anchor table code",
        toolbar:
          "customButton | undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | myCustomButton | table | code",
        setup: function (editor) {
          editor.on("ExecCommand", function (e) {
            if (e.command === "mceTableCellProps") {
              openDialog(editor);
            }
          });
        }
      });
    </script>
  </body>
</html>
